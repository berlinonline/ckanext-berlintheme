{% ckan_extends %}

{% block subtitle %}{{ _("Harvester") }}{% endblock %}


{% block breadcrumb_content %}
<li class="active">{{ h.nav_link(_('Harvester'), named_route='{0}_search'.format(c.dataset_type)) }}</li>
{% endblock %}

{% block page_heading %}
{% endblock page_heading %}

{% block grid_herounit %}
  {% block page_primary_action %}
      {% if h.check_access('harvest_source_create') %}
        <div class="page_primary_action">
          {% link_for _('Add Harvest Source'), named_route='{0}_new'.format(dataset_type), class_='button dp-button-plus' %}
        </div>
      {% endif %}
  {% endblock %}

  {% snippet 'snippets/search_form.html', type='harvest', query=c.q, sorting=sorting, sorting_selected=c.sort_by_selected, count=c.page.item_count, facets=facets, show_empty=request.args, error=c.query_error, placeholder=_("Search harvest sources...") %}

{% endblock grid_herounit %}

{% block primary_content %}
<div class="fullwidth panel--heavy">
  <div class="fullwidth__inner">
    <div class="row">
      <div class="span4">
        <button class="button button--filter js-facetingform-toggler" data-containerid="facetingform">Filter</button>
        <div class="filters modul-facetingform js-facetingform initialized isOverlayPalm isHidden" id="facetingform"
          style="display: none;">
          <div class="facetingform__background" style="position: absolute; inset: 0px; background: rgba(0, 0, 0, 0.5);">
          </div>
          <div class="facetingform__container">
            <div class="container__head">
              <h2 class="title">Facettierung</h2>
              <button type="button" class="button button--clean close" aria-label="Filter schlieÃŸen"><i
                  class="bicon bicon-times bicon-2x" aria-hidden="true"></i></button>
            </div>
            <div class="container__body">
              <div class="facets">
                {% for facet in facet_titles %}
                {{ h.snippet('snippets/facet_list.html', title=facet_titles[facet], name=facet,
                search_facets=search_facets) }}
                {% endfor %}
              </div>
            </div>
          </div>
        </div>
      </div>
      <div class="span8">

        {% block search_facets %}
        {% set facets = {
        'fields': c.fields_grouped,
        'search': c.search_facets,
        'titles': c.facet_titles,
        'translated_fields': c.translated_fields,
        'remove_field': c.remove_field }
        %}
        {% set sorting = [
        (_('Relevance'), 'score desc, metadata_modified desc'),
        (_('Name Ascending'), 'title_string asc'),
        (_('Name Descending'), 'title_string desc'),
        (_('Last Modified'), 'metadata_modified desc'),
        (_('Popular'), 'views_recent desc') if g.tracking_enabled else (false, false) ]
        %}
        {% if facets %}
        {{harvesters_info}}
        <p class="filter-list">
          {% for field in facets.fields %}
          {% set search_facets_items = facets.search.get(field)['items'] if facets.search and field in facets.search
          else [] %}
          <span class="facet">{{ facets.titles.get(field) }}:</span>
          {% for value in facets.fields[field] %}
          <span class="filtered pill">
            {%- if facets.translated_fields and (field,value) in facets.translated_fields -%}
            {{ facets.translated_fields[(field,value)] }}
            {%- else -%}
            {{ h.list_dict_filter(search_facets_items, 'name', 'display_name', value) }}
            {%- endif %}
            <a href="{{ facets.remove_field(field, value) }}" class="remove" title="{{ _('Remove') }}"><i
                class="fa fa-times"></i></a>
          </span>
          {% endfor %}
          {% endfor %}
        </p>
        <a class="show-filters btn btn-default">{{ _('Filter Results') }}</a>
        {% endif %}
        {% endblock %}

        {% block package_search_results_list %}
        {{ h.snippet('snippets/package_list.html', packages=page.items, list_class='block list--clean list--fullwidth')
        }}
        {% endblock package_search_results_list %}
        {% block page_pagination %}
        {% if c.page.page_count > 1 %}
          {{ h.snippet('snippets/pagination.html',
          page=c.page.page,
          page_count=c.page.page_count,
          cells=h.berlintheme_pagination_cells(c.page.page, c.page.page_count),
          base_path='dataset'
          )}}
        {% endif %}
        {% endblock page_pagination %}
      </div>
    </div>
  </div>
</div>

{% endblock %}

{% block secondary_content %}
{% endblock %}