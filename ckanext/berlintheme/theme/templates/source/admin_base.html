{% ckan_extends %}

{% block breadcrumb_content_root_selected %}{% endblock %}

{% block breadcrumb_content %}
  {{ super() }}
  <li class="active"><a href="">{{ _('Admin') }}</a></li>
{% endblock %}

{% block page_heading %}
  <div class="berlin-org-header">
    <h1 class="berlin-h1-flex">
      {{ harvest_source.title }}
    </h1>
    {% if h.check_access('harvest_source_update', {'id':harvest_source.id }) %}
      {{ h.nav_link(_('Admin'), named_route='harvester.admin', id=harvest_source.name, class_='btn btn-primary', icon='wrench')}}
    {% endif %}    
  </div>
{% block info %}
<div class="modul-text_bild imagealignleft">
    <!-- <h2 class="title">Image left</h2> -->
    <div class="text textile">
      {% if harvest_source.description %}
        <p class="description">
          {{ h.markdown_extract(harvest_source.description, 180) }}
        </p>
      {% else %}
        <p class="empty">{{ _('There is no description for this organization') }}</p>
      {% endif %}
    {% link_for _('read more'), controller='harvester', action='about', id=harvest_source.name %}
    </div>
</div>
{% endblock info %}

  <div class="btn-margin">
  {% if harvest_source.status and harvest_source.status.last_job and (harvest_source.status.last_job.status == 'New' or harvest_source.status.last_job.status == 'Running') %}
    <a class="button" rel="tooltip" title="There already is an unrun job for this source"><i class="fa fa-lg fa-refresh icon-refresh icon-large"></i> Reharvest</a>
  {% else %}
    {% set locale = h.dump_json({'content': _('This will re-run the harvesting for this source. Any updates at the source will overwrite the local datasets. Sources with a large number of datasets may take a significant amount of time to finish harvesting. Please confirm you would like us to start reharvesting.')}) %}
      <a href="{{ h.url_for('harvester.refresh', id=harvest_source.id) }}" class="button" data-module="confirm-action" data-module-i18n="{{ locale }}"
         title="{{ _('Start a new harvesting job for this harvest source now') }}">
        <i class="fa fa-refresh icon-refresh"></i>
        {{ _('Reharvest') }}
      </a>
  {% endif %}
  {% if harvest_source.status and harvest_source.status.last_job and (harvest_source.status.last_job.status == 'Running') %}
      <a href="{{ h.url_for('harvester.job_abort', source=harvest_source.name, id=harvest_source.status.last_job.id) }}" class="button button--light" title="Stop this Job">
        <i class="fa fa-ban icon-ban-circle"></i>
        {{ _('Stop') }}
      </a>
  {% endif %}
    {% set locale = h.dump_json({'content': _('Warning: This will remove all datasets for this source, as well as all previous job reports. Are you sure you want to continue?')}) %}
      <a href="{{ h.url_for('harvester.clear', id=harvest_source.id) }}" class="button button--light" data-module="confirm-action" data-module-i18n="{{ locale }}"
         title="{{ _('Delete all harvest jobs and existing datasets from this source') }}">
        {{ _('Clear') }}
      </a>
       <a href="{{ h.url_for('{0}.read'.format(c.dataset_type), id=harvest_source.id) }}" class="button button--light">
        <i class="fa fa-eye eye-open"></i>
        {{ _('View harvest source') }}
      </a>
    </div>
{% endblock page_heading %}

{% block content_action %}
{% endblock %}

{% block content_primary_nav %}
    {% 
    set tabs = [ 
        { "active": h.berlintheme_link_active('harvester.admin'), "label": _('Dashboard'), "link": url_for('harvester.admin', id=harvest_source.name), "icon": "dashboard" },
        { "active": h.berlintheme_link_active('harvester.job_list'), "label": _('Jobs'), "link": url_for('harvester.job_list', source=harvest_source.name,), "icon": "reorder" },
        { "active": h.berlintheme_link_active(c.dataset_type ~ '.edit'), "label": _('Edit'), "link": url_for(c.dataset_type ~ '.edit', id=harvest_source.name,), "icon": "edit" }
    ] 
    %}
    {% snippet 'snippets/tabs.html', tabs=tabs %}

{% endblock %}