{% import 'macros/form.html' as form %}
{% set action = g.form_action or '' %}

{% block errors %}{{ form.errors(error_summary) }}{% endblock %}


{# This provides a full page that renders a form for adding a dataset. It can
then itself be extended to add/remove blocks of functionality. #}
<form id="dataset-edit" class="dataset-form form--base panel--heavy" method="post" action="{{ action }}" data-module="basic-form" novalidate>
  {% block stages %}
    {{ h.snippet('package/snippets/stages.html', stages=stage) }}
  {% endblock %}

  <input type="hidden" name="_ckan_phase" value="dataset_new_1" />
  {# pkg_name used in 3 stage edit #}
  <input type="hidden" name="pkg_name" value="{{ data.id }}" />

  {% block basic_fields %}
    {% snippet 'package/snippets/package_basic_fields.html', data=data, errors=errors, licenses=c.licenses, groups_available=c.groups_available %}
  {% endblock %}

  <p aria-hidden="true">
    <span class="icon-required">*</span> Pflichtfeld
  </p>

  {% block form_actions %}
    <div class="form-actions">
      {% block delete_button %}
        {% if h.check_access('package_delete', {'id': data.id}) and not data.state == 'deleted' %}
          <a type="button" class="button button--light" title="{{ _('Delete') }}" href="{% url_for dataset_type ~ '.delete', id=data.id %}">{% block delete_button_text %}{{ _('Delete') }}{% endblock %}</a>
          {#           
          <a type="button" class="js-flyin-overlay-toggler button" data-layout="modal" data-containerid="#delete_modal" data-auralopentext="Öffnet einen Dialog zum Löschen des Datensatzes" data-auralclosetext="Schließt den Dialog" data-opentext="Dialog zum Löschen des Datensatzes öffnen" data-closetext="Dialog schließen" data-title="{{ _('Bestätigen Sie bitte die Aktion') }}">{% block delete_button_text %}{{ _('Delete') }}{% endblock %}</a>
          <div id="delete_modal" style="display: none;" >
            <p>{{ _('Are you sure you want to delete this dataset?') }}</p>
            <form id='confirm-dataset-delete-form' action="{% url_for pkg_dict.type ~ '.delete', id=pkg_dict.name %}" method="post">
              <button class="button button--light" type="submit" name="cancel" >{{ _('Cancel') }}</button>
              <button class="button button--light" type="submit" name="delete" >{{ _('Confirm Delete') }}</button>
            </form>
          </div>
          #}
        {% endif %}
      {% endblock %}
      {% block save_button %}
        <button class="button" type="submit" name="save">{% block save_button_text %}{{ _('Next: Add Data') }}{% endblock %}</button>
      {% endblock %}
    </div>
  {% endblock %}
</form>

{% block disclaimer %}
  <div class="modul-text_wichtig">
    <div class="text">
      Die <i>Lizenz</i>, die Sie ausgewählt haben gilt nur für die Inhalte aller Ressourcen, die zu diesem Datensatz gehören.
      Wenn Sie dieses Formular absenden, stimmen Sie zu, die Metadaten unter der <a href="https://creativecommons.org/publicdomain/zero/1.0/" title="Link zum Text der Creative-Commons-Zero-Lizenz">Creative Commons Zero</a> Lizenz zu veröffentlichen.
    </div>
  </div>
{% endblock disclaimer %}

